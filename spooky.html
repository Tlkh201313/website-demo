<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Fear Test</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@400;700&display=swap');
        
        /* Custom font for spooky titles */
        .spooky-title {
            font-family: 'Creepster', cursive;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.8), 0 0 10px rgba(255, 0, 0, 0.5);
        }

        /* Jumpscare Overlay */
        #jumpscare-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 100;
            cursor: pointer;
            overflow: hidden;
            user-select: none;
        }

        #jumpscare-overlay img, #jumpscare-overlay video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'spooky-red': '#cc0000',
                        'spooky-bg': '#1a1a1a',
                        'spooky-card': '#2c2c2c',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-spooky-bg min-h-screen flex items-center justify-center p-4 font-inter text-gray-100">

    <!-- Jumpscare Overlay -->
    <div id="jumpscare-overlay" class="flex items-center justify-center">
        <!-- Content for Jumpscare (Image/Video is loaded via JS) -->
        <div id="jumpscare-content" class="w-full h-full flex items-center justify-center">
            <p class="text-4xl text-spooky-red spooky-title animate-pulse">...</p>
        </div>
    </div>

    <!-- Main Quiz Container -->
    <div id="quiz-container" class="w-full max-w-lg bg-spooky-card shadow-2xl shadow-spooky-red/50 rounded-xl p-8 transition-all duration-500 ease-in-out">
        
        <h1 class="text-5xl md:text-6xl spooky-title text-spooky-red text-center mb-6 border-b-2 border-spooky-red pb-3">
            The Fear Test
        </h1>

        <!-- Status/Score -->
        <div class="flex justify-between items-center text-sm font-mono text-gray-400 mb-6">
            <p>Question: <span id="question-count">1/9</span></p>
            <p>Fear Level: <span id="fear-level">0</span></p>
        </div>

        <!-- Question Area -->
        <div id="quiz-content">
            <p id="question-text" class="text-xl mb-6 text-gray-200 font-bold leading-relaxed">
                <!-- Question text loaded here -->
            </p>
            
            <!-- Options Area -->
            <div id="options-container" class="space-y-4">
                <!-- Buttons loaded here -->
            </div>
        </div>
        
        <!-- Results Area (Hidden initially) -->
        <div id="results-content" class="hidden text-center p-6">
            <h2 class="text-4xl spooky-title text-spooky-red mb-4">Test Complete</h2>
            <p id="final-message" class="text-lg text-gray-300 mb-6">
                <!-- Final message loaded here -->
            </p>
            <button id="restart-button" class="bg-spooky-red hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300">
                Restart The Terror
            </button>
        </div>

    </div>

    <script>
        // Use an IIFE for scope
        (function() {
            // --- JUMPSCARE URL CONFIGURATION (FROM USER INPUT) ---
            const JUMPSCARE_URLS = {
                'JUMPSCARE_URL_1': 'https://placehold.co/1920x1080/000000/ff3333?text=I+CAN+HEAR+YOU', 
                'JUMPSCARE_URL_2': 'https://placehold.co/1920x1080/000000/cc0000?text=LOOK+BEHIND+YOU', 
                'JUMPSCARE_URL_3': 'https://placehold.co/1920x1080/000000/ff0000?text=IT%27S+TOO+LATE+FOR+YOU' 
            };
            // ---------------------------------------------------

            // --- GAME STATE ---
            let currentQuestionIndex = 0;
            let fearLevel = 0;
            let isJumpscareActive = false;
            let audioContextStarted = false; // New flag for audio initialization

            // --- TONE.JS SETUP (Jump Sound) ---
            // Create a Noise Synth for a sudden static burst sound effect
            const jumpSound = new Tone.NoiseSynth({
                noise: {
                    type: "white"
                },
                envelope: {
                    attack: 0.005,
                    decay: 0.1,
                    sustain: 0.0,
                    release: 0.01
                }
            }).toDestination();
            
            // --- QUIZ QUESTIONS ---
            const questions = [
                {
                    text: "The power cuts out suddenly, leaving you in darkness. Do you...",
                    options: [
                        { text: "Find a flashlight and check the fuse box.", fear: 1 },
                        { text: "Yell out and ask if anyone else is home.", fear: 3 },
                        { text: "Freeze, hold your breath, and listen intently for any noise.", fear: 5 }
                    ],
                    trigger: null
                },
                {
                    text: "You hear a faint, scraping sound coming from the ceiling directly above you. You assume it is...",
                    options: [
                        { text: "A tree branch rubbing the roof tiles.", fear: 1 },
                        { text: "A small animal or a rodent.", fear: 3 },
                        { text: "Heavy, dragging footsteps.", fear: 5 }
                    ],
                    trigger: null
                },
                {
                    text: "You look out a window and swear you see a figure standing at the edge of the woods. You...",
                    options: [
                        { text: "Dismiss it as an illusion or a piece of yard art.", fear: 1 },
                        { text: "Quickly shut the blinds and back away slowly.", fear: 3 },
                        { text: "Stare directly back, trying to determine if itâ€™s moving.", fear: 5 }
                    ],
                    trigger: { urlKey: 'JUMPSCARE_URL_1', threshold: 10 } // JUMPSCARE 1 after Q3 if fear > 10
                },
                {
                    text: "A door is creaked open slightly, revealing a pitch-black room. You must enter. You go in...",
                    options: [
                        { text: "Confidently, using your phone's screen as a light.", fear: 1 },
                        { text: "Reluctantly, slowly pushing the door wider.", fear: 3 },
                        { text: "Head first, without looking down.", fear: 5 }
                    ],
                    trigger: null
                },
                {
                    text: "You are alone in the house and your phone rings. The caller ID is 'Unknown Number'. You...",
                    options: [
                        { text: "Ignore it and put the phone on silent.", fear: 1 },
                        { text: "Answer cautiously, but don't speak first.", fear: 3 },
                        { text: "Answer and whisper, 'Who is this?'", fear: 5 }
                    ],
                    trigger: null
                },
                {
                    text: "You find a vintage music box on a dusty shelf. It is currently playing a slow, disturbing lullaby. You...",
                    options: [
                        { text: "Turn the key backward to stop the music.", fear: 1 },
                        { text: "Cover your ears and immediately leave the room.", fear: 3 },
                        { text: "Follow the sound to its source (you already found it, but you listen closer).", fear: 5 }
                    ],
                    trigger: null
                },
                {
                    text: "You feel a cold, unsettling breath on the back of your neck, but you're facing a wall. You...",
                    options: [
                        { text: "Assume it's an air vent or a draft.", fear: 1 },
                        { text: "Spin around violently, ready to fight.", fear: 3 },
                        { text: "Stand perfectly still, too terrified to move or breathe.", fear: 5 }
                    ],
                    trigger: { urlKey: 'JUMPSCARE_URL_2', threshold: 25 } // JUMPSCARE 2 after Q7 if fear > 25
                },
                {
                    text: "Something metallic drops behind you. When you look, you see a rusted, jagged knife. You...",
                    options: [
                        { text: "Pick it up to use as a weapon.", fear: 1 },
                        { text: "Kick it under the nearest piece of furniture.", fear: 3 },
                        { text: "Run as fast as you can, leaving it behind.", fear: 5 }
                    ],
                    trigger: null
                },
                {
                    text: "You find a final message scrawled in what appears to be dried blood on a mirror. It says 'The Fear Test is...' ",
                    options: [
                        { text: "Over.", fear: 1 },
                        { text: "Just Beginning.", fear: 3 },
                        { text: "Happening Now.", fear: 5 }
                    ],
                    trigger: { urlKey: 'JUMPSCARE_URL_3', threshold: 35 } // JUMPSCARE 3 after Q9 if fear > 35
                }
            ];

            // --- DOM ELEMENTS ---
            const questionTextEl = document.getElementById('question-text');
            const optionsContainerEl = document.getElementById('options-container');
            const questionCountEl = document.getElementById('question-count');
            const fearLevelEl = document.getElementById('fear-level');
            const quizContentEl = document.getElementById('quiz-content');
            const resultsContentEl = document.getElementById('results-content');
            const finalMessageEl = document.getElementById('final-message');
            const restartButton = document.getElementById('restart-button');
            const jumpscareOverlay = document.getElementById('jumpscare-overlay');
            const jumpscareContent = document.getElementById('jumpscare-content');

            // --- FUNCTIONS ---

            function loadQuestion() {
                if (currentQuestionIndex >= questions.length) {
                    showResults();
                    return;
                }

                const currentQuestion = questions[currentQuestionIndex];
                
                // Update header stats
                questionCountEl.textContent = `${currentQuestionIndex + 1}/${questions.length}`;
                fearLevelEl.textContent = fearLevel;

                // Update question text
                questionTextEl.textContent = currentQuestion.text;
                
                // Clear and load options
                optionsContainerEl.innerHTML = '';

                currentQuestion.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    button.className = 'w-full text-left p-4 rounded-lg bg-spooky-card border-2 border-spooky-red/30 hover:bg-spooky-red/20 transition duration-200 shadow-md text-gray-200 hover:text-white';
                    button.onclick = () => handleAnswer(option.fear);
                    optionsContainerEl.appendChild(button);
                });
            }

            function handleAnswer(fearIncrease) {
                // Check if a jumpscare is already in progress
                if (isJumpscareActive) return;

                // ** FIX: Explicitly start the audio context on the first user interaction **
                if (!audioContextStarted) {
                    Tone.start().then(() => {
                        console.log("Tone.js audio context successfully started.");
                        audioContextStarted = true;
                    }).catch(err => {
                        console.warn("Could not start audio context:", err);
                        // Still proceed, but prevent future attempts
                        audioContextStarted = true; 
                    });
                }
                
                // Update fear level
                fearLevel += fearIncrease;
                fearLevelEl.textContent = fearLevel;

                const currentQuestion = questions[currentQuestionIndex];
                
                // Check for Jumpscare Trigger
                if (currentQuestion.trigger && fearLevel >= currentQuestion.trigger.threshold) {
                    triggerJumpscare(JUMPSCARE_URLS[currentQuestion.trigger.urlKey]);
                    // Do not increment index yet, let the jumpscare reset the state
                } else {
                    // Go to next question
                    currentQuestionIndex++;
                    loadQuestion();
                }
            }

            function triggerJumpscare(url) {
                isJumpscareActive = true;
                
                // 1. Prepare Content (Check if URL points to an image or video)
                jumpscareContent.innerHTML = '';
                let mediaElement;
                
                // Note: Splitting the URL like this is a simplified check for the demo
                const extension = url.split('.').pop().toLowerCase();

                if (extension.match(/png|jpg|jpeg|gif/)) {
                    mediaElement = document.createElement('img');
                    mediaElement.src = url;
                    mediaElement.onerror = () => {
                         // Fallback in case placeholder fails
                        jumpscareContent.innerHTML = '<p class="text-4xl text-spooky-red spooky-title">WARNING: IMAGE FAILED TO LOAD</p>';
                    };
                } else if (extension.match(/mp4|webm/)) {
                    mediaElement = document.createElement('video');
                    mediaElement.src = url;
                    mediaElement.autoplay = true;
                    mediaElement.loop = false;
                    mediaElement.volume = 1.0; // Ensure maximum volume
                    mediaElement.onerror = () => {
                        // Fallback
                        jumpscareContent.innerHTML = '<p class="text-4xl text-spooky-red spooky-title">WARNING: VIDEO FAILED TO LOAD</p>';
                    };
                } else {
                    // Default fallback (uses the placeholder text from CSS)
                    mediaElement = document.createElement('img'); 
                    mediaElement.src = url; 
                    mediaElement.onerror = () => {
                        jumpscareContent.innerHTML = '<p class="text-4xl text-spooky-red spooky-title">JUMPSCARE TRIGGERED</p>';
                    };
                }

                jumpscareContent.appendChild(mediaElement);


                // 2. Play Sound (Must resume context for Tone.js)
                // This resume call acts as a secondary failsafe, although the check in handleAnswer is primary
                Tone.context.resume().then(() => {
                    jumpSound.triggerAttackRelease("4n", 0.05, Tone.now(), 0.8); // 0.8 volume for a loud jolt
                }).catch(e => console.error("Tone.js failed to start:", e));
                
                // 3. Display Jumpscare
                jumpscareOverlay.style.display = 'flex';

                // 4. Hide Jumpscare and Reset Game after a short delay
                setTimeout(() => {
                    jumpscareOverlay.style.display = 'none';
                    isJumpscareActive = false;
                    resetGame(); // Reset game after a jumpscare
                    jumpscareContent.innerHTML = ''; // Clear content
                }, 1500); // Display for 1.5 seconds
            }

            function showResults() {
                quizContentEl.classList.add('hidden');
                resultsContentEl.classList.remove('hidden');

                let message = `Your final fear level is **${fearLevel}**.`;
                
                if (fearLevel <= 15) {
                    message += " You seem remarkably calm. The horrors of the night hold no power over you. Perhaps you are the horror?";
                } else if (fearLevel <= 30) {
                    message += " You showed significant tension but managed to hold it together. You are clearly susceptible to fear, but you are not easily broken.";
                } else {
                    message += " Your fear level is maxed out! The shadows have clearly claimed a piece of your sanity. Congratulations, you are a certified scaredy-cat.";
                }

                finalMessageEl.innerHTML = message;
            }

            function resetGame() {
                currentQuestionIndex = 0;
                fearLevel = 0;
                quizContentEl.classList.remove('hidden');
                resultsContentEl.classList.add('hidden');
                loadQuestion();
            }

            // --- EVENT LISTENERS ---
            restartButton.onclick = resetGame;

            // Start the quiz on page load
            window.onload = loadQuestion;
        })();
    </script>
</body>
</html>
